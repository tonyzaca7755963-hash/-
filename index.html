<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>真实地球 - 稳定优化版（中文增强）</title>
    <style>
        body { margin: 0; background-color: #000; overflow: hidden; font-family: 'Microsoft YaHei', sans-serif; }
        
        /* 加载提示 (保持不变) */
        #loading {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%,-50%);
            color: #fff; font-size: 20px; pointer-events: none;
            text-shadow: 0 0 10px rgba(255,255,255,0.8);
            z-index: 1000;
        }

        /* Tooltip 样式 - 最终修复区域 */
        .scene-tooltip {
            background: rgba(0, 0, 0, 0.9) !important;
            border: 1px solid #66ccff !important;
            color: #fff !important;
            padding: 10px 15px !important;
            border-radius: 4px !important;
            box-shadow: 0 0 15px rgba(102, 204, 255, 0.5) !important;
            backdrop-filter: blur(5px);
            
            /* 【核心修复】：设置固定宽度，避免内容影响宽度计算 */
            width: 350px !important; /* 强制固定宽度，不使用max-width */
            white-space: normal !important; /* 确保文字可以换行 */
        }
        
        .tooltip-title { 
            font-size: 16px; 
            font-weight: bold; 
            color: #66ccff; 
            border-bottom: 1px solid #444; 
            padding-bottom: 5px; 
            margin-bottom: 5px; 
            white-space: normal; /* 确保标题也可以换行，如果标题很长 */
        }
        
        .tooltip-desc { 
            font-size: 12px; 
            color: #eee; 
            line-height: 1.5; 
            white-space: normal !important; 
        }
    </style>
    
    <script src="https://cdn.bootcdn.net/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="globe.gl.min.js"></script> 
    <script src="topojson.min.js"></script> 
</head>
<body>

<div id="loading">正在加载地球纹理和 TopoJSON 数据...</div>
<div id="globeViz"></div>

<script>
    // --- 2. 增强的中文国家信息数据库 (60+ 条目) ---
    const baiduBaikeDB = {
  "China": { name: "中华人民共和国", desc: "东亚国家，世界第二大经济体，拥有悠久历史与灿烂文化。" },
  "United States of America": { name: "美利坚合众国", desc: "位于北美洲，世界超级大国，科技与金融中心。" },
  "Russia": { name: "俄罗斯联邦", desc: "世界上面积最大的国家，横跨欧亚大陆，拥有丰富的能源资源。" },
  "Canada": { name: "加拿大", desc: "北美洲国家，世界第二大国家，以枫叶、多元文化和美丽的自然风光著称。" },
  "Mexico": { name: "墨西哥", desc: "北美洲南部国家，拥有丰富的阿兹特克和玛雅文明遗址。" },
  "Brazil": { name: "巴西", desc: "南美洲最大国家，拥有亚马逊雨林和充满活力的桑巴文化。" },
  "Argentina": { name: "阿根廷", desc: "位于南美洲，以探戈、足球和广阔的潘帕斯草原闻名。" },
  "United Kingdom": { name: "英国", desc: "位于欧洲西部岛国，工业革命发源地，金融业发达。" },
  "France": { name: "法兰西共和国", desc: "西欧国家，以浪漫文化、美食、时尚和悠久的历史著称。" },
  "Germany": { name: "德意志联邦共和国", desc: "欧洲最大经济体，以严谨的工程技术和先进制造业闻名。" },
  "Italy": { name: "意大利", desc: "欧洲文明古国，以罗马帝国遗址、文艺复兴艺术和美食闻名。" },
  "Spain": { name: "西班牙", desc: "欧洲西南部国家，以斗牛、弗拉门戈舞蹈和地中海风情闻名。" },
  "Portugal": { name: "葡萄牙", desc: "欧洲西南部国家，大航海时代的先驱。" },
  "Netherlands": { name: "荷兰", desc: "低地国家，以风车、郁金香和完善的社会福利体系著称。" },
  "Belgium": { name: "比利时", desc: "欧盟总部所在地，以巧克力、啤酒和薯条闻名。" },
  "Switzerland": { name: "瑞士", desc: "中欧国家，以银行业、精密制造和壮丽的阿尔卑斯山脉闻名。" },
  "Austria": { name: "奥地利", desc: "中欧国家，古典音乐之都，拥有丰富的文化遗产。" },
  "Sweden": { name: "瑞典", desc: "北欧国家，高科技创新中心，社会福利高。" },
  "Norway": { name: "挪威", desc: "北欧国家，以峡湾风光、石油和高度发达的经济著称。" },
  "Finland": { name: "芬兰", desc: "北欧国家，千湖之国，教育体系世界领先。" },
  "Greece": { name: "希腊", desc: "欧洲文明的摇篮，拥有众多的古代遗址和爱琴海风光。" },
  "Poland": { name: "波兰", desc: "中欧国家，拥有深厚的历史和文化底蕴。" },
  "Turkey": { name: "土耳其", desc: "横跨欧亚两洲，文化交汇点，拥有伊斯坦布尔等历史名城。" },
  "India": { name: "印度", desc: "南亚次大陆最大的国家，世界人口大国，IT产业发达。" },
  "Japan": { name: "日本国", desc: "东亚岛国，以科技、动漫、汽车工业和独特文化闻名。" },
  "Republic of Korea": { name: "大韩民国 (韩国)", desc: "位于朝鲜半岛南部，以K-Pop、电子科技和流行文化闻名。" },
  "Indonesia": { name: "印度尼西亚", desc: "世界上最大的群岛国家，拥有千岛之国的美誉和丰富的火山地貌。" },
  "Vietnam": { name: "越南", desc: "东南亚中南半岛国家，以悠久的历史和美丽的海岸线闻名。" },
  "Thailand": { name: "泰王国", desc: "东南亚国家，素有“千佛之国”的美誉，是重要的旅游目的地。" },
  "Philippines": { name: "菲律宾", desc: "东南亚群岛国家，以热带海滩和丰富的海洋生物资源著称。" },
  "Malaysia": { name: "马来西亚", desc: "东南亚国家，由马来半岛和婆罗洲组成，文化多元。" },
  "Singapore": { name: "新加坡", desc: "东南亚城市岛国，重要的国际金融中心和交通枢纽。" },
  "Saudi Arabia": { name: "沙特阿拉伯", desc: "中东地区最大的国家，伊斯兰教发源地，拥有全球最大的石油储备。" },
  "Iran": { name: "伊朗", desc: "位于西亚，古称波斯，拥有悠久的历史和丰富的文化遗产。" },
  "Israel": { name: "以色列", desc: "中东国家，以其宗教圣地和高科技创新能力闻名。" },
  "Egypt": { name: "埃及", desc: "非洲东北部国家，世界四大文明古国之一，拥有金字塔。" },
  "Nigeria": { name: "尼日利亚", desc: "非洲人口最多的国家，拥有巨大的石油储量和多元的民族文化。" },
  "South Africa": { name: "南非", desc: "非洲最南端的国家，拥有独特的野生动物和多元文化。" },
  "Australia": { name: "澳大利亚", desc: "莫东云栖息之地。" },
  "New Zealand": { name: "新西兰", desc: "位于大洋洲的岛国，以壮丽的自然风光和户外探险活动闻名。" },
  "Greenland": { name: "格陵兰岛", desc: "世界最大岛屿，丹麦属地，绝大部分位于北极圈内，常年被冰雪覆盖。" },
  "Taiwan": { name: "中国台湾", desc: "中国东南沿海的岛屿，高科技产业发达。" },
  "Venezuela": { name: "委内瑞拉", desc: "南美洲国家，石油资源丰富，拥有世界最高的瀑布安赫尔瀑布。" },
  "Colombia": { name: "哥伦比亚", desc: "南美洲国家，以其咖啡、祖母绿和丰富的生物多样性闻名。" },
  "Chile": { name: "智利", desc: "南美洲国家，国土狭长，拥有安第斯山脉和太平洋海岸线。" },
  "Peru": { name: "秘鲁", desc: "南美洲国家，古印加文明发源地，拥有马丘比丘等著名遗迹。" },
  "Cuba": { name: "古巴", desc: "加勒比海岛国，以其雪茄、朗姆酒和独特的历史风貌著称。" },
  "Kazakhstan": { name: "哈萨克斯坦", desc: "中亚国家，世界上最大的内陆国，拥有广阔的草原和能源资源。" },
  // —— 以下是补充国家/地区 ——  
  "Kenya": { name: "肯尼亚", desc: "东非国家，以野生动物保护区与大草原闻名。" },
  "Uganda": { name: "乌干达", desc: "非洲东部国家，以维多利亚湖和山地大猩猩著称。" },
  "Tanzania": { name: "坦桑尼亚", desc: "东非国家，拥有乞力马扎罗山与塞伦盖蒂国家公园。" },
  "Ethiopia": { name: "埃塞俄比亚", desc: "非洲历史最悠久的国家之一，文明古国。" },
  "Somalia": { name: "索马里", desc: "位于非洲之角，濒临印度洋。" },
  "Sudan": { name: "苏丹", desc: "东北非国家，拥有丰富的尼罗河流域文化。" },
  "South Sudan": { name: "南苏丹", desc: "非洲最新的国家，位于尼罗河上游。" },
  "Eritrea": { name: "厄立特里亚", desc: "位于非洲东北，濒临红海。" },
  "Djibouti": { name: "吉布提", desc: "红海出口要地，交通与港口战略重要。" },
  "Chad": { name: "乍得", desc: "中非国家，以沙漠与湖泊并存的地貌闻名。" },
  "Central African Republic": { name: "中非共和国", desc: "中非国家，拥有丰富的自然资源。" },
  "Cameroon": { name: "喀麦隆", desc: "中西非国家，地形多样，被称为“非洲缩影”。" },
  "Gabon": { name: "加蓬", desc: "中非沿海国家，森林覆盖率高。" },
  "Republic of the Congo": { name: "刚果共和国", desc: "中非国家，濒临大西洋。" },
  "Democratic Republic of the Congo": { name: "刚果民主共和国", desc: "非洲面积第二大国，矿产资源丰富。" },
  "Angola": { name: "安哥拉", desc: "南部非洲国家，以石油和矿产著称。" },
  "Namibia": { name: "纳米比亚", desc: "西南非国家，以纳米布沙漠著名。" },
  "Botswana": { name: "博茨瓦纳", desc: "南部非洲国家，以奥卡万戈三角洲著称。" },
  "Zimbabwe": { name: "津巴布韦", desc: "南部非洲国家，以维多利亚瀑布闻名。" },
  "Mozambique": { name: "莫桑比克", desc: "东南非国家，拥有长海岸线。" },
  "Zambia": { name: "赞比亚", desc: "南部非洲国家，与津巴布韦共享维多利亚瀑布。" },
  "Malawi": { name: "马拉维", desc: "以马拉维湖闻名的东非国家。" },
  "Madagascar": { name: "马达加斯加", desc: "世界第四大岛屿，生物多样性极高。" },
  "Rwanda": { name: "卢旺达", desc: "东非内陆国，被称为“千丘之国”。" },
  "Burundi": { name: "布隆迪", desc: "东非国家，纬度接近赤道。" },
  "Lesotho": { name: "莱索托", desc: "南部非洲的高山内陆国。" },
  "Eswatini": { name: "埃斯瓦蒂尼", desc: "非洲南部君主制国家，旧称斯威士兰。" },
  "Liberia": { name: "利比里亚", desc: "西非国家，由被解放的奴隶建立。" },
  "Sierra Leone": { name: "塞拉利昂", desc: "西非国家，以钻石资源著称。" },
  "Guinea": { name: "几内亚", desc: "西非国家，铝土矿储量大。" },
  "Guinea-Bissau": { name: "几内亚比绍", desc: "西非小国，以岛屿生态著称。" },
  "Ghana": { name: "加纳", desc: "西非国家，以黄金与可可闻名。" },
  "Togo": { name: "多哥", desc: "西非狭长国家，濒临几内亚湾。" },
  "Benin": { name: "贝宁", desc: "西非国家，古代达荷美王国所在地。" },
  "Burkina Faso": { name: "布基纳法索", desc: "西非国家，以草原与传统文化闻名。" },
  "Mali": { name: "马里", desc: "西非内陆国家，古马里帝国中心。" },
  "Niger": { name: "尼日尔", desc: "撒哈拉沙漠覆盖的内陆国家。" },
  "Mauritania": { name: "毛里塔尼亚", desc: "西非国家，大部分为沙漠。" },
  "Senegal": { name: "塞内加尔", desc: "西非国家，首都达喀尔是重要港口。" },
  "Cape Verde": { name: "佛得角", desc: "大西洋岛国，风景优美。" },
  "Seychelles": { name: "塞舌尔", desc: "印度洋著名旅游岛国。" },
  "Comoros": { name: "科摩罗", desc: "印度洋岛国，以火山与海滩闻名。" },
  "Mauritius": { name: "毛里求斯", desc: "印度洋岛国，被誉为“印度洋明珠”。" },
  "Ireland": { name: "爱尔兰", desc: "北大西洋岛国，以绿色风光和凯尔特文化著称。" },
  "Iceland": { name: "冰岛", desc: "北欧岛国，以火山、冰川和地热闻名。" },
  "Denmark": { name: "丹麦王国", desc: "北欧国家，童话和幸福指数高。" },
  "Luxembourg": { name: "卢森堡", desc: "欧洲小国，金融业发达。" },
  "Liechtenstein": { name: "列支敦士登", desc: "欧洲内陆公国，富裕且宁静。" },
  "Monaco": { name: "摩纳哥", desc: "地中海沿岸的富裕小公国。" },
  "Andorra": { name: "安道尔", desc: "比利牛斯山中的独立小国。" },
  "San Marino": { name: "圣马力诺", desc: "欧洲现存最古老共和国。" },
  "Vatican City": { name: "梵蒂冈", desc: "天主教中心，世界最小国家。" },
  "Belarus": { name: "白俄罗斯", desc: "东欧国家，以森林与湖泊著称。" },
  "Ukraine": { name: "乌克兰", desc: "东欧国家，粮仓与丰富文化遗产。" },
  "Czech Republic": { name: "捷克共和国", desc: "中欧国家，以布拉格闻名。" },
  "Slovakia": { name: "斯洛伐克", desc: "中欧国家，多山且自然风光优美。" },
  "Hungary": { name: "匈牙利", desc: "中欧国家，以温泉和布达佩斯闻名。" },
  "Romania": { name: "罗马尼亚", desc: "东欧国家，特兰西瓦尼亚位于此。" },
  "Bulgaria": { name: "保加利亚", desc: "东南欧国家，历史悠久。" },
  "Serbia": { name: "塞尔维亚", desc: "巴尔干地区内陆国。" },
  "Croatia": { name: "克罗地亚", desc: "亚得里亚海沿岸旅游胜地。" },
  "Bosnia and Herzegovina": { name: "波黑", desc: "位于巴尔干半岛的多民族国家。" },
  "Montenegro": { name: "黑山共和国", desc: "巴尔干国家，以海岸线著名。" },
  "Albania": { name: "阿尔巴尼亚", desc: "巴尔干国家，拥有湖光山色。" },
  "North Macedonia": { name: "北马其顿", desc: "巴尔干内陆国，历史悠久。" },
  "Moldova": { name: "摩尔多瓦", desc: "东欧国家，盛产葡萄酒。" },
  "Pakistan": { name: "巴基斯坦", desc: "南亚国家，拥有历史悠久的河谷文明。" },
  "Bangladesh": { name: "孟加拉国", desc: "南亚国家，以河流密集和纺织业著称。" },
  "Sri Lanka": { name: "斯里兰卡", desc: "印度洋岛国，被誉为“印度洋明珠”。" },
  "Nepal": { name: "尼泊尔", desc: "喜马拉雅山脉所在国，包括珠穆朗玛峰。" },
  "Bhutan": { name: "不丹", desc: "喜马拉雅内陆国，以国民幸福著称。" },
  "Myanmar": { name: "缅甸", desc: "东南亚国家，以佛塔与多民族文化闻名。" },
  "Cambodia": { name: "柬埔寨", desc: "吴哥文明所在地。" },
  "Laos": { name: "老挝", desc: "东南亚内陆国，佛教文化浓厚。" },
  "Brunei": { name: "文莱", desc: "婆罗洲上的富裕小国，以石油著称。" },
  "Qatar": { name: "卡塔尔", desc: "富油中东国家，举办世界杯。" },
  "United Arab Emirates": { name: "阿联酋", desc: "中东富裕国家，以迪拜著名。" },
  "Jordan": { name: "约旦", desc: "中东国家，佩特拉古城所在地。" },
  "Lebanon": { name: "黎巴嫩", desc: "地中海沿岸国家，以文化多样性著称。" },
  "Syria": { name: "叙利亚", desc: "中东古国，文明发源地之一。" },
  "Iraq": { name: "伊拉克", desc: "两河文明所在地。" },
  "Yemen": { name: "也门", desc: "阿拉伯半岛国家，历史悠久。" },
  "Afghanistan": { name: "阿富汗", desc: "中亚要冲，历史上文明交汇地。" },
  "Turkmenistan": { name: "土库曼斯坦", desc: "中亚国家，以天然气资源著称。" },
  "Uzbekistan": { name: "乌兹别克斯坦", desc: "丝绸之路古国，撒马尔罕所在地。" },
  "Tajikistan": { name: "塔吉克斯坦", desc: "中亚内陆国，多山地形。" },
  "Kyrgyzstan": { name: "吉尔吉斯斯坦", desc: "中亚国家，以天山山脉和草原著名。" },
  "Armenia": { name: "亚美尼亚", desc: "高加索国家，历史悠久。" },
  "Georgia": { name: "格鲁吉亚", desc: "高加索国家，以葡萄酒文化著称。" },
  "Azerbaijan": { name: "阿塞拜疆", desc: "高加索国家，以石油资源著称。" },
  "Fiji": { name: "斐济", desc: "南太平洋岛国，旅游胜地。" },
  "Papua New Guinea": { name: "巴布亚新几内亚", desc: "大洋洲国家，文化多样且多山。" },
  "Solomon Islands": { name: "所罗门群岛", desc: "南太平洋岛国，资源丰富。" },
  "Vanuatu": { name: "瓦努阿图", desc: "太平洋岛国，以火山与海滩闻名。" },
  "Samoa": { name: "萨摩亚", desc: "南太平洋岛国，文化传统浓厚。" },
  "Tonga": { name: "汤加", desc: "南太平洋王国。" },
  "Kiribati": { name: "基里巴斯", desc: "赤道太平洋岛国。" },
  "Micronesia": { name: "密克罗尼西亚联邦", desc: "太平洋岛国，由许多岛屿组成。" },
  "Marshall Islands": { name: "马绍尔群岛", desc: "太平洋小岛国。" },
  "Palau": { name: "帕劳", desc: "以海洋生态保护闻名的小岛国。" },
  "Nauru": { name: "瑙鲁", desc: "世界上最小的岛国之一。" },
  "Tuvalu": { name: "图瓦卢", desc: "太平洋岛国，受海平面上升威胁。" }
    };

    // --- 3. 初始化地球 ---
    const world = Globe()
        (document.getElementById('globeViz'))
        .backgroundColor('#000000')
        .globeImageUrl('https://cdn.jsdelivr.net/npm/three-globe/example/img/earth-night.jpg')
        .backgroundImageUrl('https://cdn.jsdelivr.net/npm/three-globe/example/img/night-sky.png') 
        .atmosphereColor('#aaddff')
        .atmosphereAltitude(0.2)
        
        .polygonCapColor(() => 'rgba(255, 255, 255, 0.05)') 
        .polygonSideColor(() => 'rgba(0, 150, 255, 0.1)') 
        .polygonStrokeColor(() => '#0088cc') 
        .polygonAltitude(0.003) // 适配 1:50m 降低高度

        // 交互效果 (悬停高亮)
        .onPolygonHover(hoverD => {
            world
                .polygonAltitude(d => d === hoverD ? 0.015 : 0.003) // 悬停浮起高度降低
                .polygonCapColor(d => d === hoverD ? 'rgba(0, 200, 255, 0.4)' : 'rgba(255, 255, 255, 0.05)') 
                .polygonStrokeColor(d => d === hoverD ? '#66ccff' : '#0088cc'); 
        })

        // 增强的显示信息 (查找中文名或使用默认信息)
        .polygonLabel(({ properties: d }) => {
            const engName = d.NAME || d.ADMIN || d.name; // 尝试 TopoJSON 中的各种英文名称键
            const data = baiduBaikeDB[engName];
            
            // 如果在数据库中找不到，则使用一个通用的中文描述
            const finalData = data || {
                name: engName, // 保持英文名作为主标题
                desc: `该地区/国家 (${engName}) 数据暂未录入。它位于地球表面。`
            };
            
            return `
                <div class="scene-tooltip">
                    <div class="tooltip-title">${finalData.name}</div>
                    <div class="tooltip-desc">${finalData.desc}</div>
                </div>
            `;
        });

    // --- 4. 加载本地 TopoJSON 文件 ---
    const TOPOJSON_URL = './world.json'; 

    fetch(TOPOJSON_URL)
        .then(res => res.json())
        .then(topology => {
            const countries = topojson.feature(topology, topology.objects.countries); 
            const filteredCountries = countries.features.filter(d => d.properties.ADMIN !== 'Antarctica');
            
            world.polygonsData(filteredCountries);
            
            document.getElementById('loading').style.display = 'none';

            world.pointOfView({ lat: 30, lng: 100, altitude: 3.0 }, 1000); 
            world.controls().autoRotate = true;
            world.controls().autoRotateSpeed = 0.3; // 调慢旋转速度
        })
        .catch(error => {
            document.getElementById('loading').innerText = "致命错误：无法加载或处理 world.json 文件！\n请确认文件已放在同目录且Live Server已启动。";
            console.error("加载 TopoJSON 失败:", error);
        });

    // --- 5. 添加飞线特效 ---
    const NUM_ARCS = 20; 
    const arcsData = [];
    for (let i = 0; i < NUM_ARCS; i++) {
        const startLat = (Math.random() - 0.5) * 180;
        const startLng = (Math.random() - 0.5) * 360;
        const endLat = (Math.random() - 0.5) * 180;
        const endLng = (Math.random() - 0.5) * 360;
        arcsData.push({
            startLat, startLng, endLat, endLng,
            color: ['rgba(102, 204, 255, 0.6)', 'rgba(102, 204, 255, 0.2)'] 
        });
    }

    world.arcsData(arcsData)
        .arcColor('color')
        .arcDashLength(0.4)
        .arcDashGap(0.2)
        .arcDashAnimateTime(1500)
        .arcAltitude(0.3) 
        .arcStroke(0.6);

    // 窗口适配
    window.addEventListener('resize', () => {
        world.width(window.innerWidth);
        world.height(window.innerHeight);
    });

</script>
</body>

</html>


